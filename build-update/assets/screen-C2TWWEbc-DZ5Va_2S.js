import{p0 as V,p1 as Y,p4 as j,pQ as q,pq as J,p6 as L,q6 as B,pj as $,p8 as a,pk as l,pb as n,pc as U,pd as i,ql as K,qk as D,pl as x,pP as C,pe as _,p5 as z,pf as A,pr as W,pg as ee,ph as Q,pi as X,pp as f,pu as Z,pv as G,p2 as ae,p7 as te,p9 as N,pa as O,px as H,pn as le,qm as re,qn as se}from"./story-u82SUoyt.js";import"./main-CmCzAIzx.js";const ne={class:"rv-geosearch-bar relative h-26 mx-8 mb-8"},oe=["placeholder","value","aria-label"],ie={class:"absolute inset-y-0 right-8 grid w-10 place-content-center"},ce=["aria-label","content"],ue=V({__name:"search-bar",setup(R){const{t:r}=j(),u=q(),c=J(),m=L(()=>u.searchVal),s=L(()=>['"',"$","!","*","+","?","^","{","}","(",")","|","[","]"].filter(p=>u.searchVal.includes(p)).join("")),o=p=>{u.setSearchTerm(p),u.setSearchRegex(p)},g=B(500,p=>{o(p)});return(p,t)=>{const e=$("tippy");return a(),l("div",ne,[n("input",{type:"text",class:U(["border-b w-full text-base py-8 outline-none focus:shadow-outline border-gray-600 h-full min-w-0",{"border-yellow-500":s.value}]),placeholder:i(r)("geosearch.searchText"),value:m.value,onInput:t[0]||(t[0]=v=>i(g)(v.target.value)),onKeyup:t[1]||(t[1]=K(v=>{i(c).mobileView&&v.target.blur()},["enter"])),"aria-label":i(r)("geosearch.searchText"),onKeypress:t[2]||(t[2]=K(D(()=>{},["prevent"]),["enter"])),enterkeyhint:"done"},null,42,oe),n("span",ie,[s.value?x((a(),l("button",{key:0,class:"cursor-default","aria-label":i(r)("geosearch.badChars",{chars:s.value}),content:i(r)("geosearch.badChars",{chars:s.value})},t[3]||(t[3]=[C(" âš  ")]),8,ce)),[[e]]):_("",!0)])])}}}),pe={class:"w-fit inline-block sm:w-1/2 h-26 mb-8 sm:mb-0 pr-16 sm:pr-0"},ve=["value","aria-label"],de={value:"",disabled:"",hidden:""},be={class:"sm:w-1/2 h-26 sm:mx-16 flex"},he=["value","aria-label"],ge={value:"",disabled:"",hidden:""},fe=["disabled","content","aria-label"],me=V({__name:"top-filters",setup(R){const{t:r}=j(),u=z("iApi"),c=q(),m=A(),s=A(),o=A(),g=A([]),p=A([]),t=A([]),e=L(()=>c.queryParams),v=L(()=>u.language),k=h=>c.setProvince(h),E=h=>c.setType(h),F=()=>{k({}),E({})},M=()=>{c.initService(u.language,u.fixture.get("geosearch").config);const h=g.value.find(b=>e.value.province===b.name)?.code,w=p.value.find(b=>e.value.type===b.name)?.code;c.getProvinces.then(b=>{g.value=b,k({province:b.find(T=>T.code===h)?.name,forceReRun:!0})}),c.getTypes.then(b=>{p.value=b,E({type:b.find(T=>T.code===w)?.name,forceReRun:!0})})},d=()=>{s.value._tippy.hide()},P=()=>{o.value._tippy.hide()},S=h=>{h.key==="Tab"&&s.value?.matches(":focus")&&navigator.userAgent.includes("Firefox")?s.value._tippy.show():s.value._tippy.hide()},I=h=>{h.key==="Tab"&&o.value?.matches(":focus")&&navigator.userAgent.includes("Firefox")?o.value._tippy.show():o.value._tippy.hide()};return W(()=>{M(),t.value.push(ee(v,M))}),Q(()=>{s.value?.addEventListener("blur",d),s.value?.addEventListener("keyup",S),o.value?.addEventListener("blur",P),o.value?.addEventListener("keyup",I)}),X(()=>{t.value.forEach(h=>h()),s.value?.removeEventListener("blur",d),s.value?.removeEventListener("keyup",S),o.value?.removeEventListener("blur",P),o.value?.removeEventListener("keyup",I)}),(h,w)=>{const b=$("truncate"),T=$("tippy");return a(),l("div",{class:"rv-geosearch-top-filters sm:flex items-center w-full ml-8 mb-14",ref_key:"el",ref:m},[n("div",pe,[x((a(),l("select",{class:"border-b border-b-gray-600 w-full h-full py-0 cursor-pointer",value:e.value.province,"aria-label":i(r)("geosearch.filters.province"),onChange:w[0]||(w[0]=y=>k({province:y.target.value})),ref_key:"selectProvince",ref:s},[x((a(),l("option",de,[C(f(i(r)("geosearch.filters.province")),1)])),[[b]]),(a(!0),l(Z,null,G(g.value,y=>x((a(),l("option",{key:y.code},[C(f(y.name),1)])),[[b]])),128))],40,ve)),[[b],[T,{content:i(r)("select.items"),trigger:"manual",placement:"top-start"}]])]),n("div",be,[x((a(),l("select",{class:"border-b border-b-gray-600 w-full h-full py-0 cursor-pointer max-w-150",value:e.value.type,"aria-label":i(r)("geosearch.filters.type"),onChange:w[1]||(w[1]=y=>E({type:y.target.value})),ref_key:"selectFilter",ref:o},[n("option",ge,f(i(r)("geosearch.filters.type")),1),(a(!0),l(Z,null,G(p.value,y=>(a(),l("option",{key:y.code},f(y.name),1))),128))],40,he)),[[b],[T,{content:i(r)("select.items"),trigger:"manual",placement:"top-start"}]]),x((a(),l("button",{type:"button",class:"text-gray-500 w-1/8 h-24 pl-8 pr-16 sm:pr-8 hover:text-black disabled:cursor-default disabled:text-gray-400",disabled:!e.value.type&&!e.value.province,onClick:F,content:i(r)("geosearch.filters.clear"),"aria-label":i(r)("geosearch.filters.clear")},w[2]||(w[2]=[n("div",{class:"rv-geosearch-icon"},[n("svg",{class:"fill-current w-18 h-18",viewBox:"0 0 23 21"},[n("path",{d:"M 14.7574,20.8284L 17.6036,17.9822L 14.7574,15.1716L 16.1716,13.7574L 19.0178,16.568L 21.8284,13.7574L 23.2426,15.1716L 20.432,17.9822L 23.2426,20.8284L 21.8284,22.2426L 19.0178,19.3964L 16.1716,22.2426L 14.7574,20.8284 Z M 2,2L 19.9888,2.00001L 20,2.00001L 20,2.01122L 20,3.99999L 19.9207,3.99999L 13,10.9207L 13,22.909L 8.99999,18.909L 8.99999,10.906L 2.09405,3.99999L 2,3.99999L 2,2 Z "})])],-1)]),8,fe)),[[T,{placement:"bottom"}]])])],512)}}}),ye={class:"rv-geosearch-bottom-filters"},xe={class:"bg-white"},Le={class:"ml-8 cursor-pointer font-normal"},ke=["checked"],we=V({__name:"bottom-filters",setup(R){const{t:r}=j(),u=z("iApi"),c=q(),m=L(()=>c.resultsVisible),s=B(300,t=>{g(t).then(e=>{o({extent:e,visible:m.value})})}),o=t=>{c.setMapExtent(t)},g=async t=>t.sr.wkid===4326?t:await u.geo.proj.projectGeometry(4326,t),p=t=>{g(u.geo.map.getExtent()).then(e=>{o({extent:e,visible:t})})};return Q(()=>{u.event.on(ae.MAP_EXTENTCHANGE,s,"geosearch_map_extent")}),X(()=>{u.event.off("geosearch_map_extent")}),(t,e)=>(a(),l("div",ye,[n("div",xe,[n("label",Le,[n("input",{type:"checkbox",class:"border-2 mx-8 border-gray-600 cursor-pointer",checked:m.value,onChange:e[0]||(e[0]=v=>p(v.target.checked)),onKeypress:e[1]||(e[1]=K(D(()=>{},["prevent"]),["enter"]))},null,40,ke),C(f(i(r)("geosearch.visible")),1)])])]))}}),_e={},Ee={class:"w-full h-6 relative overflow-hidden rounded-full indeterminate mb-14"},Te={class:"h-full progressbar bg-blue-800 rounded-full top-0","aria-valuemin":"0","aria-valuemax":"100"},Ce={class:"flex items-center h-full"};function Re(R,r){return a(),l("div",Ee,[n("div",Te,[n("span",Ce,[le(R.$slots,"default",{},void 0,!0)])])])}const Ae=Y(_e,[["render",Re],["__scopeId","data-v-0a8d1c36"]]),$e={class:"flex flex-col h-full"},Me={key:1,class:"text-red-900 text-xs px-8 mb-10"},Pe={key:2,class:"px-8 mb-10 py-8 flex-grow text-wrap border-y border-gray-600 overflow-y-auto"},Ve={class:"relative h-48"},je={class:"font-bold text-blue-600"},qe={key:3,class:"rv-results-list flex-grow mb-5 border-t border-b border-gray-600 overflow-y-auto"},Fe=["onClick"],Se={class:"rv-result-description px-8"},He={class:"flex-1 text-left truncate font-bold leading-tight"},Ke=["innerHTML"],Ze={key:0,class:"text-gray-600 text-sm"},Ge={key:1,class:"hidden"},ze={key:2,class:"text-sm font-normal"},Oe=V({__name:"screen",props:{panel:{type:Object}},setup(R){const{t:r}=j(),u=z("iApi"),c=q(),m=L(()=>c.searchVal.replace(/["!*$+?^{}()|[\]\\]/g,"").trim()),s=L(()=>c.searchResults),o=L(()=>c.loadingResults),g=L(()=>c.failedServices),p=e=>{let v=new re("zoomies",[[[e.bbox[0],e.bbox[1]],[e.bbox[0],e.bbox[3]],[e.bbox[2],e.bbox[3]],[e.bbox[2],e.bbox[1]],[e.bbox[0],e.bbox[1]]]],se.latLongSR(),!0);u.geo.map.zoomMapTo(v)},t=(e,v)=>{const k=e.replace(new RegExp(`${c.searchRegex}`,"gi"),E=>'<span class="font-bold text-blue-600">'+E+"</span>");return v?k+",":k};return(e,v)=>{const k=te("panel-screen"),E=$("truncate"),F=$("focus-item"),M=$("focus-list");return a(),N(k,{panel:R.panel},{header:O(()=>[C(f(i(r)("geosearch.title")),1)]),content:O(()=>[n("div",$e,[H(ue),H(me),o.value?(a(),N(Ae,{key:0,class:"flex-none"})):_("",!0),g.value.length>0&&!o.value?(a(),l("div",Me,f(i(r)("geosearch.serviceError",{services:g.value.join(", ")})),1)):_("",!0),m.value&&s.value.length===0&&!o.value?(a(),l("div",Pe,[n("span",Ve,[C(f(i(r)("geosearch.noResults")),1),n("span",je,'"'+f(m.value)+'"',1)])])):_("",!0),s.value.length>0?x((a(),l("ul",qe,[(a(!0),l(Z,null,G(s.value,(d,P)=>(a(),l("li",{class:"relative h-56",key:P},[x((a(),l("button",{type:"button",class:"absolute inset-0 h-full w-full hover:bg-gray-300 default-focus-style",onClick:S=>p(d),style:{"border-bottom":"1px solid lightgray"},"truncate-trigger":""},[n("div",Se,[x((a(),l("div",He,[n("span",{innerHTML:t(d.name,d.location.province)},null,8,Ke),d.location.province?(a(),l("span",Ze,f(d.location.city?" "+d.location.city+", "+d.location.province.abbr:" "+d.location.province.abbr),1)):_("",!0),d.type?(a(),l("span",Ge,"; ")):_("",!0),d.type?(a(),l("span",ze,[v[0]||(v[0]=n("br",null,null,-1)),C(f(d.type),1)])):_("",!0)])),[[E,{externalTrigger:!0,options:{placement:"top-start"}}]])])],8,Fe)),[[F,"show-truncate"]])]))),128))])),[[M]]):_("",!0),H(we,{class:"mt-auto"})])]),_:1},8,["panel"])}}});export{Oe as default};
