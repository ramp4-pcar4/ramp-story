import{cR as K,af as Ze,a3 as F,a7 as V,a8 as W,a9 as Q,aa as X,Y as I,aY as Ie,a5 as le,a4 as oe,a1 as ke,a6 as Oe,d5 as Re,aj as De,H as we}from"./story-u82SUoyt.js";import{r as R,O as _e,m as ve,u as Ue}from"./TimeOnly-BR6daUyu-BGOh8DJt.js";import{n as M}from"./ImmutableArray-CiJxhY8_-Kqx7aWRu.js";import{I as Ee,h as se}from"./shared-CWBqh2zd-DbZF0kO5.js";import{z as Le,M as Pe}from"./number-BJi_xsDz-CEICM6uM.js";let ce=class{};var o;(function(e){e.AsyncNotEnabled="AsyncNotEnabled",e.ModulesNotSupported="ModulesNotSupported",e.CircularModules="CircularModules",e.CannotCompareDateAndTime="CannotCompareDateAndTime",e.NeverReach="NeverReach",e.UnsupportedHashType="UnsupportedHashType",e.InvalidParameter="InvalidParameter",e.FeatureSetDoesNotHaveSubtypes="FeatureSetDoesNotHaveSubtypes",e.UnexpectedToken="UnexpectedToken",e.Unrecognized="Unrecognized",e.UnrecognizedType="UnrecognizedType",e.MaximumCallDepth="MaximumCallDepth",e.BooleanConditionRequired="BooleanConditionRequired",e.TypeNotAllowedInFeature="TypeNotAllowedInFeature",e.KeyMustBeString="KeyMustBeString",e.WrongNumberOfParameters="WrongNumberOfParameters",e.CallNonFunction="CallNonFunction",e.NoFunctionInTemplateLiteral="NoFunctionInTemplateLiteral",e.NoFunctionInDictionary="NoFunctionInDictionary",e.NoFunctionInArray="NoFunctionInArray",e.AssignModuleFunction="AssignModuleFunction",e.LogicExpressionOrAnd="LogicExpressionOrAnd",e.LogicalExpressionOnlyBoolean="LogicalExpressionOnlyBoolean",e.FunctionNotFound="FunctionNotFound",e.InvalidMemberAccessKey="InvalidMemberAccessKey",e.UnsupportedUnaryOperator="UnsupportUnaryOperator",e.InvalidIdentifier="InvalidIdentifier",e.MemberOfNull="MemberOfNull",e.UnsupportedOperator="UnsupportedOperator",e.Cancelled="Cancelled",e.ModuleAccessorMustBeString="ModuleAccessorMustBeString",e.ModuleExportNotFound="ModuleExportNotFound",e.Immutable="Immutable",e.OutOfBounds="OutOfBounds",e.IllegalResult="IllegalResult",e.FieldNotFound="FieldNotFound",e.PortalRequired="PortalRequired",e.LogicError="LogicError",e.ArrayAccessorMustBeNumber="ArrayAccessMustBeNumber",e.KeyAccessorMustBeString="KeyAccessorMustBeString",e.WrongSpatialReference="WrongSpatialReference",e.CannotChangeTimeZoneTime="CannotChangeTimeZoneTime",e.CannotChangeTimeZoneDateOnly="CannotChangeTimeZoneDateOnly"})(o||(o={}));const fe={[o.TypeNotAllowedInFeature]:"Feature attributes only support dates, numbers, strings, guids.",[o.LogicError]:"Logic error - {reason}",[o.CannotCompareDateAndTime]:"Cannot compare date or dateonly with timeonly types",[o.NeverReach]:"Encountered unreachable logic",[o.AsyncNotEnabled]:"Async Arcade must be enabled for this script",[o.ModuleAccessorMustBeString]:"Module accessor must be a string",[o.ModuleExportNotFound]:"Module has no export with provided identifier",[o.ModulesNotSupported]:"Current profile does not support modules",[o.ArrayAccessorMustBeNumber]:"Array accessor must be a number",[o.FunctionNotFound]:"Function not found",[o.FieldNotFound]:"Key not found - {key}",[o.CircularModules]:"Circular module dependencies are not allowed",[o.Cancelled]:"Execution cancelled",[o.UnsupportedHashType]:"Type not supported in hash function",[o.IllegalResult]:"Value is not a supported return type",[o.PortalRequired]:"Portal is required",[o.InvalidParameter]:"Invalid parameter",[o.WrongNumberOfParameters]:"Call with wrong number of parameters",[o.Unrecognized]:"Unrecognized code structure",[o.UnrecognizedType]:"Unrecognized type",[o.WrongSpatialReference]:"Cannot work with geometry in this spatial reference. It is different to the execution spatial reference",[o.BooleanConditionRequired]:"Conditions must use booleans",[o.NoFunctionInDictionary]:"Dictionaries cannot contain functions.",[o.NoFunctionInArray]:"Arrays cannot contain functions.",[o.NoFunctionInTemplateLiteral]:"Template Literals do not expect functions by value.",[o.KeyAccessorMustBeString]:"Accessor must be a string",[o.KeyMustBeString]:"Object keys must be a string",[o.Immutable]:"Object is immutable",[o.UnexpectedToken]:"Unexpected token",[o.MemberOfNull]:"Cannot access property of null object",[o.MaximumCallDepth]:"Exceeded maximum function depth",[o.OutOfBounds]:"Out of bounds",[o.InvalidIdentifier]:"Identifier not recognized",[o.CallNonFunction]:"Expression is not a function",[o.InvalidMemberAccessKey]:"Cannot access value using a key of this type",[o.AssignModuleFunction]:"Cannot assign function to module variable",[o.UnsupportedUnaryOperator]:"Unsupported unary operator",[o.UnsupportedOperator]:"Unsupported operator",[o.LogicalExpressionOnlyBoolean]:"Logical expressions must be boolean",[o.LogicExpressionOrAnd]:"Logical expression can only be combined with || or &&",[o.CannotChangeTimeZoneTime]:"Cannot change the timezone of a Time",[o.CannotChangeTimeZoneDateOnly]:"Cannot change the timezone of a DateOnly",[o.FeatureSetDoesNotHaveSubtypes]:"FeatureSet does not have subtypes"};let ze=class extends Error{constructor(...e){super(...e)}};class U extends ze{constructor(n,r){super($(r)+n.message,{cause:n}),this.loc=null,Error.captureStackTrace&&Error.captureStackTrace(this,U),r?.loc&&(this.loc=r.loc)}}class T extends Error{constructor(n,r,t,a){super("Execution error - "+$(t)+K(fe[r],a)),this.loc=null,this.declaredRootClass="esri.arcade.arcadeexecutionerror",Error.captureStackTrace&&Error.captureStackTrace(this,T),t?.loc&&(this.loc=t.loc)}}function $(e){return e&&e.loc?`Line : ${e.loc.start?.line}, ${e.loc.start?.column}: `:""}class de extends Error{constructor(n,r,t,a){super("Compilation error - "+$(t)+K(fe[r],a)),this.loc=null,this.declaredRootClass="esri.arcade.arcadecompilationerror",Error.captureStackTrace&&Error.captureStackTrace(this,de),t?.loc&&(this.loc=t.loc)}}let Rn=class pe extends Error{constructor(){super("Uncompilable code structures"),this.declaredRootClass="esri.arcade.arcadeuncompilableerror",Error.captureStackTrace&&Error.captureStackTrace(this,pe)}};function Dn(e,n,r){return r.declaredRootClass==="esri.arcade.arcadeexecutionerror"||r.declaredRootClass==="esri.arcade.arcadecompilationerror"?r.loc===null&&n?.loc?new U(r,{cause:r}):r:(r.declaredRootClass==="esri.arcade.featureset.support.featureseterror"||r.declaredRootClass==="esri.arcade.featureset.support.sqlerror"||r.declaredRootClass,n?.loc?new U(r,{cause:r}):r)}var E;(function(e){e.UnrecognizedUri="UnrecognizedUri",e.UnsupportedUriProtocol="UnsupportedUriProtocol"})(E||(E={}));const je={[E.UnrecognizedUri]:"Unrecognized uri - {uri}",[E.UnsupportedUriProtocol]:"Unrecognized uri protocol"};class me extends Error{constructor(n,r){super(K(je[n],r)),this.declaredRootClass="esri.arcade.arcademoduleerror",Error.captureStackTrace&&Error.captureStackTrace(this,me)}}class D{constructor(){}}function ie(e,n,r){if(e instanceof D&&!(e instanceof G)){const t=new G;return t.fn=e,t.parameterEvaluator=r,t.context=n,t}return e}class wn extends D{constructor(n){super(),this.fn=n}createFunction(n){return(...r)=>this.fn(n,{preparsed:!0,arguments:r})}call(n,r){return this.fn(n,r)}marshalledCall(n,r,t,a){return a(n,r,(s,l,u)=>{u=u.map(c=>c instanceof D&&!(c instanceof G)?ie(c,n,a):c);const p=this.call(t,{args:u});return Ze(p)?p.then(c=>ie(c,t,a)):p})}}class G extends D{constructor(){super(...arguments),this.fn=null,this.context=null}createFunction(n){return this.fn.createFunction(this.context)}call(n,r){return this.fn.marshalledCall(n,r,this.context,this.parameterEvaluator)}marshalledCall(n,r,t){return this.fn.marshalledCall(n,r,this.context,this.parameterEvaluator)}}class k extends M{constructor(n,r,t,a,s,l){super(n),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=r,this._hasZ=t,this._hasM=a,this._cacheId=s,this._partId=l}get(n){if(this._lazyPt[n]===void 0){const r=this._elements[n];if(r===void 0)return;const t=this._hasZ,a=this._hasM;let s;s=t&&!a?new F(r[0],r[1],r[2],void 0,this._spRef):a&&!t?new F(r[0],r[1],void 0,r[2],this._spRef):t&&a?new F(r[0],r[1],r[2],r[3],this._spRef):new F(r[0],r[1],this._spRef),s.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+n.toString(),this._lazyPt[n]=s}return this._lazyPt[n]}equalityTest(n){return n===this||n!==null&&n instanceof k&&n.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}}class ee extends M{constructor(n,r,t,a,s){super(n),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=t,this._hasM=a,this._spRef=r,this._cacheId=s}get(n){if(this._lazyPath[n]===void 0){const r=this._elements[n];if(r===void 0)return;this._lazyPath[n]=new k(r,this._spRef,this._hasZ,this._hasM,this._cacheId,n)}return this._lazyPath[n]}equalityTest(n){return n===this||n!==null&&n instanceof ee&&n.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}class Je{constructor(n){this.value=n}}class Ye{constructor(n){this.value=n}}const g={type:"VOID"},Be=Symbol("BREAK"),Ge=Symbol("CONTINUE");function w(e,n,r){return n===""||n==null||n===r||n===r?e:e=e.split(n).join(r)}function j(e){return e instanceof D}function ne(e){return e instanceof ce}function L(e){return!!y(e)||!!N(e)||!!f(e)||!!m(e)||!!h(e)||!!b(e)||e===null||e===g||typeof e=="number"}function qe(e,n){return e===void 0?n:e}function He(e){return e==null?"":C(e)||Z(e)?"Array":f(e)?"Date":h(e)?"Time":m(e)?"DateOnly":y(e)?"String":b(e)?"Boolean":N(e)?"Number":e?.declaredClass==="esri.arcade.Attachment"?"Attachment":e?.declaredClass==="esri.arcade.Portal"?"Portal":e?.declaredClass==="esri.arcade.Dictionary"?"Dictionary":be(e)?"KnowledgeGraph":e instanceof ce?"Module":he(e)?"Feature":e instanceof F?"Point":e instanceof V?"Polygon":e instanceof W?"Polyline":e instanceof Q?"Multipoint":e instanceof X?"Extent":j(e)?"Function":ye(e)?"FeatureSet":ge(e)?"FeatureSetCollection":e===g?"":typeof e=="number"&&isNaN(e)?"Number":"Unrecognized Type"}function y(e){return typeof e=="string"||e instanceof String}function b(e){return typeof e=="boolean"}function N(e){return typeof e=="number"}function Ke(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e}function Ve(e){return e instanceof I}function C(e){return Array.isArray(e)}function he(e){return e?.arcadeDeclaredClass==="esri.arcade.Feature"}function We(e){return e?.declaredClass==="esri.Graphic"}function Qe(e){return e instanceof Ie}function ye(e){return e?.declaredRootClass==="esri.arcade.featureset.support.FeatureSet"}function Xe(e){return e?.declaredClass==="esri.arcade.Dictionary"}function ge(e){return e?.declaredRootClass==="esri.arcade.featureSetCollection"}function be(e){return e?.declaredClass==="esri.rest.knowledgeGraph.KnowledgeGraph"}function Z(e){return e instanceof M}function f(e){return e instanceof R}function m(e){return e instanceof _e}function h(e){return e instanceof ve}function q(e){return e!=null&&typeof e=="object"}function P(e){return e instanceof Date}function $e(e,n,r,t,a){if(e.length<n||e.length>r)throw new T(t,o.WrongNumberOfParameters,a)}function en(e){return e<0?-Math.round(-e):Math.round(e)}function re(e,n){return isNaN(e)||n==null||n===""?e.toString():(n=w(n,"‰",""),n=w(n,"¤",""),Le(e,{pattern:n}))}function J(e,n){return n==null||n===""?e.toISOString(!0):e.toFormat(Ne(n),{locale:le(),numberingSystem:"latn"})}function Ne(e,n=!1){e=e.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let r="";const t=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|Z{1,5}|.)/g;for(const a of e.match(t)||[])switch(a){case"D":r+="d";break;case"DD":r+="dd";break;case"DDD":r+="o";break;case"d":r+="c";break;case"ddd":r+="ccc";break;case"dddd":r+="cccc";break;case"M":r+="L";break;case"MM":r+="LL";break;case"MMM":r+="LLL";break;case"MMMM":r+="LLLL";break;case"YY":r+="yy";break;case"Y":case"YYYY":r+="yyyy";break;case"Q":r+="q";break;case"Z":r+="Z";break;case"ZZ":r+="ZZ";break;case"ZZZ":r+="ZZZ";break;case"ZZZZ":r+=n?"[ZZZZ]":"ZZZZ";break;case"ZZZZZ":r+=n?"[ZZZZZ]":"ZZZZZ";break;case"S":r+="'S'";break;case"SS":r+="'SS'";break;case"SSS":r+="u";break;case"A":case"a":r+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":r+=a;break;default:a.length>=2&&a.slice(0,1)==="["&&a.slice(-1)==="]"?r+=`'${a.slice(1,-1)}'`:r+=`'${a}'`}return r}function i(e,n,r){switch(r){case">":return e>n;case"<":return e<n;case">=":return e>=n;case"<=":return e<=n}return!1}function nn(e,n,r){if(e===null){if(n===null||n===g)return i(null,null,r);if(N(n))return i(0,n,r);if(y(n)||b(n))return i(0,d(n),r);if(f(n))return i(0,n.toNumber(),r);if(h(n)||m(n))return i(e,n.toNumber(),r)}if(e===g){if(n===null||n===g)return i(null,null,r);if(N(n))return i(0,n,r);if(y(n)||b(n))return i(0,d(n),r);if(f(n))return i(0,n.toNumber(),r);if(h(n)||m(n))return i(e,n.toNumber(),r)}else if(N(e)){if(N(n))return i(e,n,r);if(b(n))return i(e,d(n),r);if(n===null||n===g)return i(e,0,r);if(y(n))return i(e,d(n),r);if(f(n)||h(n)||m(n))return i(e,n.toNumber(),r)}else if(y(e)){if(y(n))return i(x(e),x(n),r);if(f(n)||h(n)||m(n))return i(d(e),n.toNumber(),r);if(N(n))return i(d(e),n,r);if(n===null||n===g)return i(d(e),0,r);if(b(n))return i(d(e),d(n),r)}else if(f(e)){if(f(n))return e.timeZone!==n.timeZone&&(e.isUnknownTimeZone?e=R.arcadeDateAndZoneToArcadeDate(e,n.timeZone):n.isUnknownTimeZone&&(n=R.arcadeDateAndZoneToArcadeDate(n,e.timeZone))),i(e.toNumber(),n.toNumber(),r);if(n===null||n===g)return i(e.toNumber(),0,r);if(N(n))return i(e.toNumber(),n,r);if(b(n)||y(n))return i(e.toNumber(),d(n),r);if(h(n))throw new T(null,o.CannotCompareDateAndTime,null);if(m(n))return i(e.toNumber(),n.toNumber(),r)}else if(b(e)){if(b(n))return i(e,n,r);if(N(n))return i(d(e),d(n),r);if(f(n)||h(n)||m(n))return i(d(e),n.toNumber(),r);if(n===null||n===g)return i(d(e),0,r);if(y(n))return i(d(e),d(n),r)}else if(m(e)){if(f(n))return i(e.toNumber(),n.toNumber(),r);if(n===null||n===g)return i(e.toNumber(),0,r);if(N(n))return i(e.toNumber(),n,r);if(b(n)||y(n))return i(e.toNumber(),d(n),r);if(h(n))throw new T(null,o.CannotCompareDateAndTime,null);if(m(n))return i(e.toNumber(),n.toNumber(),r)}else if(h(e)){if(f(n))throw new T(null,o.CannotCompareDateAndTime,null);if(n===null||n===g)return i(e.toNumber(),0,r);if(N(n))return i(e.toNumber(),n,r);if(b(n)||y(n))return i(e.toNumber(),d(n),r);if(h(n))return i(e.toNumber(),n.toNumber(),r);if(m(n))throw new T(null,o.CannotCompareDateAndTime,null)}return!!Se(e,n)&&(r==="<="||r===">=")}function Se(e,n){if(e===n||e===null&&n===g||n===null&&e===g)return!0;if(f(e)&&f(n)||h(e)&&h(n)||m(e)&&m(n))return e.equals(n);if(e instanceof ee||e instanceof k)return e.equalityTest(n);if(e instanceof F&&n instanceof F){const r=e.cache._arcadeCacheId,t=n.cache._arcadeCacheId;if(r!=null)return r===t}return!!(q(e)&&q(n)&&(e._arcadeCacheId===n._arcadeCacheId&&e._arcadeCacheId!==void 0&&e._arcadeCacheId!==null||e._underlyingGraphic===n._underlyingGraphic&&e._underlyingGraphic!==void 0&&e._underlyingGraphic!==null))}function x(e,n){if(y(e))return e;if(e===null)return"";if(N(e))return re(e,n);if(b(e))return e.toString();if(f(e))return J(e,n);if(h(e)||m(e))return e.toFormat(n);if(e instanceof I)return JSON.stringify(e.toJSON());if(C(e)){const r=[];for(let t=0;t<e.length;t++)r[t]=z(e[t]);return"["+r.join(",")+"]"}if(e instanceof M){const r=[];for(let t=0;t<e.length();t++)r[t]=z(e.get(t));return"["+r.join(",")+"]"}return e!==null&&typeof e=="object"&&e.castToText!==void 0?e.castToText():j(e)?"object, Function":e===g?"":ne(e)?"object, Module":""}function rn(e){const n=[];if(!C(e))return null;if(e instanceof M){for(let r=0;r<e.length();r++)n[r]=d(e.get(r));return n}for(let r=0;r<e.length;r++)n[r]=d(e[r]);return n}function Ce(e,n,r=!1){if(y(e))return e;if(e===null)return"";if(N(e))return re(e,n);if(b(e))return e.toString();if(f(e))return J(e,n);if(h(e)||m(e))return e.toFormat(n);if(e instanceof I)return e instanceof X?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+H(e.spatialReference)+"}":H(e.toJSON(),(t,a)=>t.key===a.key?0:t.key==="spatialReference"?1:a.key==="spatialReference"||t.key<a.key?-1:t.key>a.key?1:0);if(C(e)){const t=[];for(let a=0;a<e.length;a++)t[a]=z(e[a],r);return"["+t.join(",")+"]"}if(e instanceof M){const t=[];for(let a=0;a<e.length();a++)t[a]=z(e.get(a),r);return"["+t.join(",")+"]"}return e!==null&&typeof e=="object"&&e.castToText!==void 0?e.castToText(r):j(e)?"object, Function":e===g?"":ne(e)?"object, Module":""}function z(e,n=!1){if(e===null)return"null";if(b(e)||N(e)||y(e))return JSON.stringify(e);if(e instanceof I||e instanceof M||Array.isArray(e))return Ce(e,null,n);if(f(e))return JSON.stringify(n?e.getTime():J(e,""));if(h(e)||m(e))return JSON.stringify(e.toString());if(e!==null&&typeof e=="object"){if(e.castToText!==void 0)return e.castToText(n)}else if(e===g)return"null";return"null"}function d(e,n){return N(e)?e:e===null||e===""?0:f(e)||m(e)||h(e)?NaN:b(e)?e?1:0:C(e)||e===""||e===void 0?NaN:n!==void 0&&y(e)?(n=w(n,"‰",""),n=w(n,"¤",""),Pe(e,{pattern:n})):e===g?0:Number(e)}function tn(e,n){if(f(e))return e;if(y(e)){const r=an(e,n);if(r)return R.dateTimeToArcadeDate(r)}return null}function an(e,n){const r=/ (\d\d)/,t=Ue(n);let a=oe.fromISO(e,{zone:t});return a.isValid||r.test(e)&&(e=e.replace(r,"T$1"),a=oe.fromISO(e,{zone:n}),a.isValid)?a:null}function on(e){return b(e)?e:y(e)?(e=e.toLowerCase())==="true":!!N(e)&&e!==0&&!isNaN(e)}function sn(e,n){const r=JSON.parse(e);return r&&!r.spatialReference&&(r.spatialReference=n),ke(r)}function un(e,n){return e==null?null:(e.spatialReference!==null&&e.spatialReference!==void 0||(e.spatialReference=n),e)}function ln(e){if(e===null)return null;if(e instanceof F)return e.x==="NaN"||e.x===null||isNaN(e.x)?null:e;if(e instanceof V){if(e.rings.length===0)return null;for(const n of e.rings)if(n.length>0)return e;return null}if(e instanceof W){if(e.paths.length===0)return null;for(const n of e.paths)if(n.length>0)return e;return null}return e instanceof Q?e.points.length===0?null:e:e instanceof X?e.xmin==="NaN"||e.xmin===null||isNaN(e.xmin)?null:e:null}function Ae(e,n){if(!e||!e.domain)return n;let r=null,t=null;if(f(n))r=n.toNumber();else if(m(n))r=n.toString();else if(h(n))r=n.toStorageString();else if(e.field.type==="string"||e.field.type==="esriFieldTypeString")r=x(n);else{if(n==null)return null;if(n==="")return n;r=d(n)}for(let a=0;a<e.domain.codedValues.length;a++){const s=e.domain.codedValues[a];s.code===r&&(t=s)}return t===null?x(n):t.name}function Te(e,n){if(!e||!e.domain)return n;let r=null;const t=x(n);for(let a=0;a<e.domain.codedValues.length;a++){const s=e.domain.codedValues[a];s.name===t&&(r=s)}return r===null?n:r.code}function Y(e,n,r=null,t=null){if(!n||!n.fields)return null;let a,s,l=null;for(let S=0;S<n.fields.length;S++){const A=n.fields[S];A.name.toLowerCase()===e.toString().toLowerCase()&&(l=A)}if(l===null)throw new T(null,o.FieldNotFound,null,{key:e});let u=n.typeIdField,p="id",c=n.types;if(n.subtypeField&&(u=n.subtypeField,p="code",c=n.subtypes??[]),t===null&&r&&u)t=r.hasField(u)?r.field(u):null;else if(u&&t!==null){let S=!1;for(const A of c||[])if(t===A[p]){S=!0;break}if(!S){for(const A of c||[])if(t===A.name){t=A[p],S=!0;break}}S||(t=null,r&&u&&(t=r.hasField(u)?r.field(u):null))}return t!=null&&c.some(S=>S[p]===t&&(a=S.domains?.[l.name],a&&a.type==="inherited"&&(a=ue(l.name,n),s=!0),!0)),s||a||(a=ue(e,n)),{field:l,domain:a}}function ue(e,n){let r;return n.fields.some(t=>(t.name.toLowerCase()===e.toLowerCase()&&(r=t.domain),!!r)),r}function H(e,n){n||(n={}),typeof n=="function"&&(n={cmp:n});const r=typeof n.cycles=="boolean"&&n.cycles,t=n.cmp&&(a=n.cmp,function(l){return function(u,p){const c={key:u,value:l[u]},S={key:p,value:l[p]};return a(c,S)}});var a;const s=[];return function l(u){if(u?.toJSON&&typeof u.toJSON=="function"&&(u=u.toJSON()),u===void 0)return;if(typeof u=="number")return isFinite(u)?""+u:"null";if(typeof u!="object")return JSON.stringify(u);let p,c;if(Array.isArray(u)){for(c="[",p=0;p<u.length;p++)p&&(c+=","),c+=l(u[p])||"null";return c+"]"}if(u===null)return"null";if(s.includes(u)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const S=s.push(u)-1,A=Object.keys(u).sort(t?.(u));for(c="",p=0;p<A.length;p++){const te=A[p],ae=l(u[te]);ae&&(c&&(c+=","),c+=JSON.stringify(te)+":"+ae)}return s.splice(S,1),"{"+c+"}"}(e)}function cn(e){if(e===null)return null;const n=[];for(const r of e)r?.arcadeDeclaredClass&&r.arcadeDeclaredClass==="esri.arcade.Feature"?n.push(r.geometry()):n.push(r);return n}function O(e,n){if(!(n instanceof F))throw new T(null,o.InvalidParameter,null);e.push(n.hasZ?n.hasM?[n.x,n.y,n.z,n.m]:[n.x,n.y,n.z]:[n.x,n.y])}function fn(e,n){if(C(e)||Z(e)){let r=!1,t=!1,a=[],s=n;if(C(e)){for(const l of e)O(a,l);a.length>0&&(s=e[0].spatialReference,r=e[0].hasZ,t=e[0].hasM)}else if(e instanceof k)a=e._elements,a.length>0&&(r=e._hasZ,t=e._hasM,s=e.get(0).spatialReference);else{if(!Z(e))throw new T(null,o.InvalidParameter,null);for(const l of e.toArray())O(a,l);a.length>0&&(s=e.get(0).spatialReference,r=e.get(0).hasZ===!0,t=e.get(0).hasM===!0)}return a.length===0?null:(Oe(a)||(a=a.slice().reverse()),new V({rings:[a],spatialReference:s,hasZ:r,hasM:t}))}return e}function dn(e,n){if(C(e)||Z(e)){let r=!1,t=!1,a=[],s=n;if(C(e)){for(const l of e)O(a,l);a.length>0&&(s=e[0].spatialReference,r=e[0].hasZ===!0,t=e[0].hasM===!0)}else if(e instanceof k)a=e._elements,a.length>0&&(r=e._hasZ,t=e._hasM,s=e.get(0).spatialReference);else if(Z(e)){for(const l of e.toArray())O(a,l);a.length>0&&(s=e.get(0).spatialReference,r=e.get(0).hasZ===!0,t=e.get(0).hasM===!0)}return a.length===0?null:new W({paths:[a],spatialReference:s,hasZ:r,hasM:t})}return e}function pn(e,n){if(C(e)||Z(e)){let r=!1,t=!1,a=[],s=n;if(C(e)){for(const l of e)O(a,l);a.length>0&&(s=e[0].spatialReference,r=e[0].hasZ===!0,t=e[0].hasM===!0)}else if(e instanceof k)a=e._elements,a.length>0&&(r=e._hasZ,t=e._hasM,s=e.get(0).spatialReference);else if(Z(e)){for(const l of e.toArray())O(a,l);a.length>0&&(s=e.get(0).spatialReference,r=e.get(0).hasZ===!0,t=e.get(0).hasM===!0)}return a.length===0?null:new Q({points:a,spatialReference:s,hasZ:r,hasM:t})}return e}function mn(e,n=!1){const r=[];if(e===null)return r;if(C(e)===!0){for(let t=0;t<e.length;t++){const a=x(e[t]);a===""&&n!==!0||r.push(a)}return r}if(e instanceof M){for(let t=0;t<e.length();t++){const a=x(e.get(t));a===""&&n!==!0||r.push(a)}return r}if(L(e)){const t=x(e);return t===""&&n!==!0||r.push(t),r}return[]}let B=0;function hn(e){return B++,B%100==0?(B=0,new Promise(n=>{setTimeout(()=>{n(e)},0)})):e}function yn(e,n,r){switch(r){case"&":return e&n;case"|":return e|n;case"^":return e^n;case"<<":return e<<n;case">>":return e>>n;case">>>":return e>>>n}}function _(e,n=null){return e==null?null:b(e)||N(e)||y(e)?e:e instanceof I?n?.keepGeometryType===!0?e:e.toJSON():e instanceof M?e.toArray().map(r=>_(r,n)):Array.isArray(e)?e.map(r=>_(r,n)):P(e)?e:f(e)?e.toJSDate():h(e)?e.toString():m(e)?e.toJSDate():e!==null&&typeof e=="object"&&e.castAsJson!==void 0?e.castAsJson(n):null}async function gn(e,n,r,t,a){const s=await Me(e,n,r);a[t]=s}async function Me(e,n=null,r=null){if(e instanceof M&&(e=e.toArray()),e==null)return null;if(L(e)||e instanceof I||P(e)||f(e))return _(e,r);if(Array.isArray(e)){const t=[],a=[];for(const s of e)s===null||L(s)||s instanceof I||P(s)||f(s)?a.push(_(s,r)):(a.push(null),t.push(gn(s,n,r,a.length-1,a)));return t.length>0&&await Promise.all(t),a}return e!==null&&typeof e=="object"&&e.castAsJsonAsync!==void 0?e.castAsJsonAsync(n,r):null}function v(e){return Fe(e)?e.parent:e}function Fe(e){return e&&"declaredClass"in e&&e.declaredClass==="esri.layers.support.SubtypeSublayer"}function bn(e){return e&&"declaredClass"in e&&e.declaredClass==="esri.layers.SubtypeGroupLayer"}function Nn(e,n,r){const t=v(e.fullSchema());return t===null||!t.fields?null:Y(n,t,e,r)}function Sn(e){const n=v(e.fullSchema());return n===null?null:n.fields?n.subtypeField?{subtypeField:n.subtypeField,subtypes:n.subtypes?n.subtypes.map(r=>({name:r.name,code:r.code})):[]}:n.typeIdField?{subtypeField:n.typeIdField,subtypes:n.types?n.types.map(r=>({name:r.name,code:r.id})):[]}:null:null}function Cn(e,n,r,t){const a=v(e.fullSchema());if(a===null||!a.fields)return null;const s=Y(n,a,e,t);if(r===void 0)try{r=e.field(n)}catch{return null}return Ae(s,r)}function An(e,n,r,t){const a=v(e.fullSchema());if(a===null||!a.fields)return null;if(r===void 0){try{r=e.field(n)}catch{return null}return r}return Te(Y(n,a,e,t),r)}function Tn(e){return e?.timeZone??"system"}function Mn(e){const n=v(e.fullSchema());if(n===null||!n.fields)return null;const r=[];for(const t of n.fields)r.push(Ee(t));return{objectIdField:n.objectIdField,globalIdField:n.globalIdField??"",geometryType:se[n.geometryType]===void 0?"":se[n.geometryType],fields:r}}function Fn(e,n){return e==="system"&&(e=R.systemTimeZoneCanonicalName),{version:xe,engineVersion:Re,timeZone:e,spatialReference:n instanceof De?n.toJSON():n,application:we.applicationName??"",engine:"web",locale:le()}}const xe="1.28",_n=Object.freeze(Object.defineProperty({__proto__:null,ImplicitResult:Ye,ReturnResult:Je,absRound:en,arcadeVersion:xe,autoCastArrayOfPointsToMultiPoint:pn,autoCastArrayOfPointsToPolygon:fn,autoCastArrayOfPointsToPolyline:dn,autoCastFeatureToGeometry:cn,binaryOperator:yn,breakResult:Be,castAsJson:_,castAsJsonAsync:Me,continueResult:Ge,defaultExecutingContext:Fn,defaultTimeZone:Tn,defaultUndefined:qe,equalityTest:Se,featureDomainCodeLookup:An,featureDomainValueLookup:Cn,featureFullDomain:Nn,featureSchema:Mn,featureSubtypes:Sn,fixNullGeometry:ln,fixSpatialReference:un,formatDate:J,formatNumber:re,getDomain:Y,getDomainCode:Te,getDomainValue:Ae,getType:He,greaterThanLessThan:nn,isArray:C,isBoolean:b,isDate:f,isDateOnly:m,isDictionary:Xe,isFeature:he,isFeatureSet:ye,isFeatureSetCollection:ge,isFunctionParameter:j,isGeometry:Ve,isGraphic:We,isImmutableArray:Z,isInteger:Ke,isJsDate:P,isKnowledgeGraph:be,isModule:ne,isNumber:N,isObject:q,isQuery:Qe,isSimpleType:L,isString:y,isSubtypeGrouplayer:bn,isSubtypeSublayer:Fe,isTime:h,multiReplace:w,parseGeometryFromJson:sn,pcCheck:$e,stableStringify:H,standardiseDateFormat:Ne,tick:hn,toBoolean:on,toDate:tn,toNumber:d,toNumberArray:rn,toString:x,toStringArray:mn,toStringExplicit:Ce,voidOperation:g},Symbol.toStringTag,{value:"Module"}));export{Sn as $,Fn as A,cn as B,C,wn as D,L as E,ge as F,ee as G,be as H,He as I,ce as J,Ke as K,on as L,x as M,pn as N,Ve as O,tn as P,Cn as Q,Dn as R,N as S,T,j as U,nn as V,Nn as W,An as X,fn as Y,Z,en as _,Xe as a,yn as a0,de as a1,me as a2,E as a3,G as a4,Je as a5,Be as a6,Ge as a7,We as a8,Ye as a9,_n as aa,Rn as ab,D as ac,ie as ad,hn as ae,Fe as af,mn as ag,Y as ah,Ae as ai,Te as aj,P as ak,b,m as c,f as d,Tn as e,d as f,qe as g,h,Ne as i,ln as j,k,g as l,Me as m,o as n,Se as o,dn as p,w as q,ye as r,rn as s,he as t,Ce as u,$e as v,_ as w,Mn as x,y,un as z};
