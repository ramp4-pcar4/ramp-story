import{pM as c,p2 as o,pN as r,pz as A}from"./story-DE9AooAy.js";import"./main-CsLUkpBy.js";class f extends A{_parseConfig(t){if(t){const i=c(this.$vApp.$pinia);t.alwaysOn&&i.setAlwaysOn(!0);const e=t.extentSetIds;e&&Array.isArray(e)&&e.length>0&&i.setExtentSetIds(e)}}get config(){return super.config}}function m(a,t,i,e){const s=a-t,n=t+s/2,h=Math.min(s,i-e);return n>i?{min:i-h,max:i,changed:!0}:n<e?{min:e,max:e+h,changed:!0}:{min:t,max:a,changed:!1}}class d extends f{schemaEH="";extentEH="";added(){this._parseConfig(this.config);const t=this.$vApp.$watch(()=>this.config,i=>this._parseConfig(i));this.removed=()=>{t(),c(this.$vApp.$pinia).$reset(),this.evtOff("schemaEH"),this.evtOff("extentEH")},this.schemaEH=this.$iApi.event.on(o.MAP_BASEMAPCHANGE,i=>{i.schemaChanged&&this.checkActive()}),this.$iApi.geo.map.created?this.checkActive():this.$iApi.event.once(o.MAP_CREATED,()=>{this.checkActive()})}checkActive(){const t=c(this.$vApp.$pinia);t.alwaysOn||t.extentSetIds.includes(this.$iApi.geo.map.getExtentSet().id)?t.active||(t.setActive(!0),this.extentEH=this.$iApi.event.on(o.MAP_EXTENTCHANGE,i=>{t.enforcing||this.enforceBoundary(i,!1)})):t.active&&(t.setActive(!1),this.evtOff("extentEH"))}evtOff(t){this[t]&&(this.$iApi.event.off(this[t]),this[t]="")}enforceBoundary(t,i){const e=this.$iApi.geo.map.getExtentSet().maximumExtent,s=m(t.xmax,t.xmin,e.xmax,e.xmin),n=m(t.ymax,t.ymin,e.ymax,e.ymin);if(n.changed||s.changed){i&&(this.$iApi.geo.map.esriView.extent=e.toESRI());const h=r.fromParams("extguard",s.min,n.min,s.max,n.max,t.sr),p=c(this.$vApp.$pinia);p.setEnforcing(!0),setTimeout(()=>{this.$iApi.geo.map.zoomMapTo(h,void 0,!0,400,"ease-in-out").then(()=>{p.setEnforcing(!1),this.enforceBoundary(this.$iApi.geo.map.getExtent(),!0)})},150)}}}export{d as default};
